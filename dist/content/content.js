const e={formats:{supported:["bold","italic","underline","strikethrough"],definitions:{bold:{id:"bold",label:"B",tooltip:"Gras",className:"ltf-font-bold",shortcut:"Ctrl+B"},italic:{id:"italic",label:"I",tooltip:"Italique",className:"ltf-italic",shortcut:"Ctrl+I"},underline:{id:"underline",label:"U",tooltip:"Souligné",className:"ltf-underline",shortcut:"Ctrl+U"},strikethrough:{id:"strikethrough",label:"S",tooltip:"Barré",className:"ltf-line-through",shortcut:"Ctrl+Shift+S"}}},ui:{toolbox:{width:152,height:40,buttonSize:32,buttonSpacing:6,offsetTop:10,offsetBottom:10,offsetSides:10,animationDuration:200,fadeOutDuration:150,zIndex:1e4,cssPrefix:"ltf-",colors:{background:"#ffffff",border:"#e1e5e9",text:"#666666",textHover:"#0a66c2",backgroundHover:"#f3f2ef",backgroundActive:"#e1e5e9"},styles:{borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08)",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",fontSize:"14px",fontWeight:"600"}},buttons:{borderRadius:"4px",transition:"all 0.1s ease",clickFeedbackDuration:100}},events:{linkedinNotification:["input","change","keyup"]},detection:{debounceDelay:200,stabilizationDelay:50,minSelectionLength:1,multiWordStabilizationDelay:100,excludeClasses:["ltf-extension","ltf-toolbox","linkedin-ads","ad-banner","sponsored-content"],readOnlyAttributes:["readonly","disabled","aria-readonly"],linkedinSelectors:['[data-placeholder*="partager"]','[data-placeholder*="What\'s"]','[data-placeholder*="share"]','.ql-editor[contenteditable="true"]','[role="textbox"]','[data-placeholder*="comment"]','[data-placeholder*="Add a comment"]','[data-placeholder*="commentaire"]',".comments-comment-box__form textarea",".comments-comment-texteditor",'[data-placeholder*="message"]','[data-placeholder*="Write a message"]','[data-placeholder*="Rédigez"]',".msg-form__contenteditable",".msg-form__compose",'[data-placeholder*="headline"]','[data-placeholder*="summary"]','[data-placeholder*="experience"]','textarea[name*="summary"]','textarea[name*="description"]','div[contenteditable="true"]',"textarea",'input[type="text"]',".editor-content",'[data-editor="true"]'],contextValidation:{maxDepth:10,linkedinClasses:["feed-shared-update-v2","comments-comment-box","msg-form","artdeco-card","feed-shared-text","share-creation-state","editor-content"]}},performance:{cleanupInterval:3e4},security:{allowedDomains:["linkedin.com","*.linkedin.com"],maxInputLength:5e4},meta:{lastUpdated:(new Date).toISOString()}};function t(e,t,...n){}const n="initialization",i="formatting",o="text_replacement",r="ui_interaction",s="unknown",a="low",l="medium",c="high",d="critical";class h extends Error{constructor(e,t=s,n=l,i={}){super(e),this.name="ExtensionError",this.type=t,this.severity=n,this.context=i,this.timestamp=(new Date).toISOString(),this.userAgent=navigator.userAgent,this.url=window.location.href,Error.captureStackTrace&&Error.captureStackTrace(this,h)}serialize(){return{message:this.message,type:this.type,severity:this.severity,context:this.context,timestamp:this.timestamp,userAgent:this.userAgent,url:this.url,stack:this.stack}}}const u=new class{constructor(){this.errorCount=new Map,this.errorHistory=[],this.maxHistorySize=100,this.suppressedErrors=new Set,this.setupGlobalErrorHandling()}setupGlobalErrorHandling(){window.addEventListener("error",e=>{this.handleError(new h(e.message,s,l,{filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error}))}),window.addEventListener("unhandledrejection",e=>{this.handleError(new h(`Unhandled promise rejection: ${e.reason}`,s,l,{reason:e.reason}))})}handleError(e,t=!1){if(e instanceof h||(e=new h(e.message||"Unknown error",s,l,{originalError:e})),this.isErrorSuppressed(e))return;const n=`${e.type}_${e.message}`;if(this.errorCount.set(n,(this.errorCount.get(n)||0)+1),this.addToHistory(e),this.logError(e),this.handleBySeverity(e),t)throw e}isErrorSuppressed(e){return this.suppressedErrors.has(e.type)||this.suppressedErrors.has(`${e.type}_${e.message}`)}addToHistory(e){this.errorHistory.push(e.serialize()),this.errorHistory.length>this.maxHistorySize&&this.errorHistory.shift()}logError(e){this.getLogLevel(e.severity);e.type,e.message,e.context}getLogLevel(e){switch(e){case a:return"debug";case l:return"warn";case c:case d:return"error";default:return"warn"}}handleBySeverity(e){switch(e.severity){case a:break;case l:this.handleMediumError(e);break;case c:this.handleHighError(e);break;case d:this.handleCriticalError(e)}}handleMediumError(e){e.type}handleHighError(e){e.type===i&&this.notifyUser("Une erreur de formatage s'est produite. Veuillez réessayer.","warning")}handleCriticalError(e){e.serialize(),this.notifyUser("Une erreur critique s'est produite. L'extension va être désactivée.","error")}notifyUser(e,t="info"){}suppressError(e){this.suppressedErrors.add(e)}unsuppressError(e){this.suppressedErrors.delete(e)}getErrorStats(){return{totalErrors:this.errorHistory.length,errorCounts:Object.fromEntries(this.errorCount),recentErrors:this.errorHistory.slice(-10),suppressedErrors:Array.from(this.suppressedErrors)}}clearErrorHistory(){this.errorHistory=[],this.errorCount.clear()}async safeExecute(e,t=s,n={}){try{return await e()}catch(i){return this.handleError(new h(i.message||"Safe execution failed",t,l,{...n,originalError:i})),null}}createErrorWrapper(e,t=s,n={}){return async(...i)=>this.safeExecute(()=>e(...i),t,{...n,arguments:i})}};const m=new class{constructor(){this.isInitialized=!1,this.currentSelection=null,this.currentField=null,this.selectionHandlers=new Set,this.debounceTimer=null,this.isProcessingMouseUp=!1,this.handleSelectionChange=this.handleSelectionChange.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}init(){if(!this.isInitialized)return u.safeExecute(()=>{document.addEventListener("selectionchange",this.handleSelectionChange,!0),document.addEventListener("mouseup",this.handleMouseUp,!0),document.addEventListener("keyup",this.handleKeyUp,!0),this.observeNewFields(),this.isInitialized=!0},n,{component:"selection-detector"})}observeNewFields(){new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&this.checkForLinkedInFields(e)})})}).observe(document.body,{childList:!0,subtree:!0}),this.checkForLinkedInFields(document.body)}checkForLinkedInFields(t){const n=e.detection.linkedinSelectors;n.length,n.forEach(e=>{try{t.querySelectorAll(e).forEach(e=>{e.hasAttribute("data-ltf-monitored")||this.monitorField(e)})}catch(n){n.message}})}monitorField(e){this.isValidLinkedInField(e)&&e.setAttribute("data-ltf-monitored","true")}isValidLinkedInField(n){const i=e.detection;for(const e of i.readOnlyAttributes)if(n.hasAttribute(e)&&"false"!==n.getAttribute(e))return t(0,0,n.tagName),!1;for(const e of i.excludeClasses)if(n.classList.contains(e))return t(0,0,n.tagName),!1;return this.isInLinkedInContext(n)}isInLinkedInContext(n){if(!window.location.hostname.includes("linkedin.com"))return!1;let i=n.parentElement,o=0;const r=e.detection.contextValidation,s=r.maxDepth;for(;i&&o<s;){const e=i.classList;for(const n of r.linkedinClasses)if(e.contains(n))return t(0,0),!0;i=i.parentElement,o++}return!0}handleSelectionChange(e){this.isProcessingMouseUp||this.debounceSelectionChange()}handleMouseUp(e){this.isProcessingMouseUp=!0;const t=this.getSelectionStabilizationDelay();setTimeout(()=>{this.processSelection(),this.isProcessingMouseUp=!1},t)}handleKeyUp(e){(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Shift"].includes(e.key)||e.shiftKey)&&this.debounceSelectionChange()}debounceSelectionChange(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.processSelection()},e.detection.debounceDelay)}processSelection(){const t=window.getSelection();if(!t||0===t.rangeCount)return void this.clearSelection();const n=t.getRangeAt(0),i=t.toString().trim();if(i.length<e.detection.minSelectionLength)return i.length,void this.clearSelection();const o=this.findLinkedInFieldImproved(n);if(!o)return i.substring(0,50),n.commonAncestorContainer.tagName,void this.clearSelection();const r=i.trim().split(/\s+/).length,s=r>1;i.length,o.tagName,o.id,this.setSelection({text:i,range:n,field:o,fieldInfo:this.getFieldInfo(o),isMultiWord:s,wordCount:r})}findLinkedInField(n){let i=n,o=0;for(;i&&o<20;){if(i.nodeType===Node.ELEMENT_NODE){if(i.hasAttribute("data-ltf-monitored"))return i;for(const n of e.detection.linkedinSelectors)try{if(i.matches(n)&&this.isValidLinkedInField(i))return this.monitorField(i),i}catch(r){t(0,0,r.message)}}i=i.parentElement,o++}return null}getFieldInfo(e){return{tagName:e.tagName.toLowerCase(),type:e.type||"unknown",placeholder:e.getAttribute("placeholder")||e.getAttribute("data-placeholder")||"",role:e.getAttribute("role")||"",classes:Array.from(e.classList),id:e.id||"",isContentEditable:"true"===e.contentEditable}}setSelection(e){this.currentSelection=e,this.currentField=e.field,e.text.substring(0,50),e.fieldInfo.tagName,this.notifySelectionHandlers("selection",e)}clearSelection(){this.currentSelection&&(this.notifySelectionHandlers("deselection",{previousSelection:this.currentSelection}),this.currentSelection=null,this.currentField=null)}addSelectionHandler(e){this.selectionHandlers.add(e)}removeSelectionHandler(e){this.selectionHandlers.delete(e)}notifySelectionHandlers(e,t){this.selectionHandlers.forEach(n=>{try{n(e,t)}catch(i){}})}getCurrentSelection(){return this.currentSelection}getCurrentField(){return this.currentField}getSelectionStabilizationDelay(){const t=window.getSelection();if(!t||0===t.rangeCount)return e.detection.stabilizationDelay;return t.toString().trim().split(/\s+/).length>1?e.detection.multiWordStabilizationDelay:e.detection.stabilizationDelay}findLinkedInFieldImproved(e){let t=this.findLinkedInField(e.commonAncestorContainer);return t||(t=this.findLinkedInField(e.startContainer),t||(t=this.findLinkedInField(e.endContainer),t||this.findLinkedInFieldInSelection(e)))}findLinkedInFieldInSelection(e){try{const t=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,null,!1);let n;for(;n=t.nextNode();)if(e.intersectsNode(n)){const e=this.findLinkedInField(n);if(e)return e}}catch(t){}return null}destroy(){this.isInitialized&&(document.removeEventListener("selectionchange",this.handleSelectionChange,!0),document.removeEventListener("mouseup",this.handleMouseUp,!0),document.removeEventListener("keyup",this.handleKeyUp,!0),this.debounceTimer&&clearTimeout(this.debounceTimer),this.selectionHandlers.clear(),this.currentSelection=null,this.currentField=null,this.isInitialized=!1,this.isProcessingMouseUp=!1)}};const f=new class{constructor(){this.isVisible=!1,this.toolboxElement=null,this.currentSelection=null,this.formatHandlers=new Map,this.isAnimating=!1,this.handleDocumentClick=this.handleDocumentClick.bind(this),this.handleButtonClick=this.handleButtonClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.init()}init(){return u.safeExecute(()=>{this.createToolboxElement(),document.addEventListener("click",this.handleDocumentClick,!0),document.addEventListener("keydown",this.handleKeyDown,!0)},n,{component:"toolbox"})}createToolboxElement(){this.toolboxElement&&this.toolboxElement.remove();const t=e.ui.toolbox,n=t.cssPrefix;this.toolboxElement=document.createElement("div"),this.toolboxElement.id="ltf-toolbox",this.toolboxElement.className=`\n      ${n}fixed\n      ${n}bg-toolbox-bg\n      ${n}border\n      ${n}border-toolbox-border\n      ${n}rounded-toolbox\n      ${n}shadow-toolbox\n      ${n}flex\n      ${n}items-center\n      ${n}gap-1\n      ${n}p-1\n      ${n}opacity-0\n      ${n}pointer-events-none\n      ${n}transition-all\n      ${n}duration-200\n    `.trim().replace(/\s+/g," "),this.toolboxElement.style.cssText=`\n      position: fixed;\n      z-index: ${t.zIndex};\n      width: ${t.width}px;\n      height: ${t.height}px;\n      background: ${t.colors.background};\n      border: 1px solid ${t.colors.border};\n      border-radius: ${t.styles.borderRadius};\n      box-shadow: ${t.styles.boxShadow};\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: ${t.buttonSpacing}px;\n      opacity: 0;\n      pointer-events: none;\n      transition: all 0.2s ease-out;\n      transform: translateY(8px);\n      font-family: ${t.styles.fontFamily};\n    `,this.createButtons(),document.body.appendChild(this.toolboxElement)}createButtons(){const t=e.formats.definitions,n=e.ui.toolbox,i=e.ui.buttons;Object.keys(t),Object.values(t).forEach(e=>{const t=document.createElement("button");t.id=`ltf-btn-${e.id}`,t.className=`ltf-toolbox-btn ltf-btn-${e.id}`,t.setAttribute("data-format",e.id),t.setAttribute("title",e.tooltip),t.textContent=e.label,t.style.cssText=`\n        width: ${n.buttonSize}px;\n        height: ${n.buttonSize}px;\n        border: none;\n        border-radius: ${i.borderRadius};\n        background: transparent;\n        color: ${n.colors.text};\n        font-size: ${n.styles.fontSize};\n        font-weight: ${n.styles.fontWeight};\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: ${i.transition};\n        user-select: none;\n        -webkit-user-select: none;\n      `,e.className&&("bold"===e.id?t.style.fontWeight="bold":"italic"===e.id?t.style.fontStyle="italic":"underline"===e.id?t.style.textDecoration="underline":"strikethrough"===e.id&&(t.style.textDecoration="line-through")),t.addEventListener("mouseenter",()=>{t.style.backgroundColor=n.colors.backgroundHover,t.style.color=n.colors.textHover}),t.addEventListener("mouseleave",()=>{t.style.backgroundColor="transparent",t.style.color=n.colors.text}),t.addEventListener("click",this.handleButtonClick),this.toolboxElement.appendChild(t)})}show(e){if(this.isAnimating)return;this.currentSelection=e,this.isVisible=!0;const t=this.calculatePosition(e);this.toolboxElement.style.left=t.x+"px",this.toolboxElement.style.top=t.y+"px",this.animateShow()}calculatePosition(t){const n=t.range,i=e.ui.toolbox,o=this.getOptimalSelectionRect(n);let r=o.left+o.width/2-i.width/2,s=o.top-i.height-i.offsetTop;const a=window.innerWidth,l=window.innerHeight,c=i.offsetSides,d=a-i.width-i.offsetSides;return r<c?r=c:r>d&&(r=d),s<i.offsetTop&&(s=o.bottom+i.offsetBottom),s+i.height>l-i.offsetBottom&&(s=l-i.height-i.offsetBottom),{x:r,y:s}}animateShow(){this.isAnimating=!0,this.toolboxElement.style.pointerEvents="auto",this.toolboxElement.style.opacity="1",this.toolboxElement.style.transform="translateY(0)",setTimeout(()=>{this.isAnimating=!1},e.ui.toolbox.animationDuration)}hide(){this.isVisible&&!this.isAnimating&&(this.isVisible=!1,this.isAnimating=!0,this.toolboxElement.style.opacity="0",this.toolboxElement.style.transform="translateY(8px)",this.toolboxElement.style.pointerEvents="none",setTimeout(()=>{this.currentSelection=null,this.isAnimating=!1},e.ui.toolbox.fadeOutDuration))}handleButtonClick(t){return u.safeExecute(()=>{t.preventDefault(),t.stopPropagation();const n=t.currentTarget,i=n.getAttribute("data-format");if(!i)throw new h("No format type found on button",r,l,{buttonId:n.id});n.style.backgroundColor=e.ui.toolbox.colors.backgroundActive,setTimeout(()=>{n.style.backgroundColor="transparent"},e.ui.buttons.clickFeedbackDuration),this.triggerFormatting(i),this.hide()},r,{formatType:t.currentTarget?.getAttribute("data-format")})}triggerFormatting(e){if(this.currentSelection&&this.formatHandlers.has(e)){const n=this.formatHandlers.get(e);try{n(this.currentSelection,e)}catch(t){}}}addFormatHandler(e,t){this.formatHandlers.set(e,t)}removeFormatHandler(e){this.formatHandlers.delete(e)}handleDocumentClick(e){this.isVisible&&(this.toolboxElement.contains(e.target)||setTimeout(()=>{const e=window.getSelection();e&&e.toString().trim().length>0||this.hide()},50))}getOptimalSelectionRect(e){try{const t=e.getClientRects();if(0===t.length)return e.getBoundingClientRect();if(1===t.length)return t[0];const n=t[0],i=t[t.length-1],o=Math.min(n.left,i.left),r=Math.max(n.right,i.right)-o,s=o+r/2;return{left:s-r/2,right:s+r/2,top:n.top,bottom:n.bottom,width:r,height:n.height,x:s-r/2,y:n.y}}catch(t){return e.getBoundingClientRect()}}handleKeyDown(e){this.isVisible&&"Escape"===e.key&&(e.preventDefault(),this.hide())}isShowing(){return this.isVisible}getCurrentSelection(){return this.currentSelection}destroy(){this.toolboxElement&&(document.removeEventListener("click",this.handleDocumentClick,!0),document.removeEventListener("keydown",this.handleKeyDown,!0),this.toolboxElement.parentNode&&this.toolboxElement.parentNode.removeChild(this.toolboxElement),this.toolboxElement=null,this.currentSelection=null,this.formatHandlers.clear(),this.isVisible=!1,this.isAnimating=!1)}},p={bold:{A:"𝐀",B:"𝐁",C:"𝐂",D:"𝐃",E:"𝐄",F:"𝐅",G:"𝐆",H:"𝐇",I:"𝐈",J:"𝐉",K:"𝐊",L:"𝐋",M:"𝐌",N:"𝐍",O:"𝐎",P:"𝐏",Q:"𝐐",R:"𝐑",S:"𝐒",T:"𝐓",U:"𝐔",V:"𝐕",W:"𝐖",X:"𝐗",Y:"𝐘",Z:"𝐙",a:"𝐚",b:"𝐛",c:"𝐜",d:"𝐝",e:"𝐞",f:"𝐟",g:"𝐠",h:"𝐡",i:"𝐢",j:"𝐣",k:"𝐤",l:"𝐥",m:"𝐦",n:"𝐧",o:"𝐨",p:"𝐩",q:"𝐪",r:"𝐫",s:"𝐬",t:"𝐭",u:"𝐮",v:"𝐯",w:"𝐰",x:"𝐱",y:"𝐲",z:"𝐳",0:"𝟎",1:"𝟏",2:"𝟐",3:"𝟑",4:"𝟒",5:"𝟓",6:"𝟔",7:"𝟕",8:"𝟖",9:"𝟗"},italic:{A:"𝘈",B:"𝘉",C:"𝘊",D:"𝘋",E:"𝘌",F:"𝘍",G:"𝘎",H:"𝘏",I:"𝘐",J:"𝘑",K:"𝘒",L:"𝘓",M:"𝘔",N:"𝘕",O:"𝘖",P:"𝘗",Q:"𝘘",R:"𝘙",S:"𝘚",T:"𝘛",U:"𝘜",V:"𝘝",W:"𝘞",X:"𝘟",Y:"𝘠",Z:"𝘡",a:"𝘢",b:"𝘣",c:"𝘤",d:"𝘥",e:"𝘦",f:"𝘧",g:"𝘨",h:"𝘩",i:"𝘪",j:"𝘫",k:"𝘬",l:"𝘭",m:"𝘮",n:"𝘯",o:"𝘰",p:"𝘱",q:"𝘲",r:"𝘳",s:"𝘴",t:"𝘵",u:"𝘶",v:"𝘷",w:"𝘸",x:"𝘹",y:"𝘺",z:"𝘻"},monospace:{A:"𝙰",B:"𝙱",C:"𝙲",D:"𝙳",E:"𝙴",F:"𝙵",G:"𝙶",H:"𝙷",I:"𝙸",J:"𝙹",K:"𝙺",L:"𝙻",M:"𝙼",N:"𝙽",O:"𝙾",P:"𝙿",Q:"𝚀",R:"𝚁",S:"𝚂",T:"𝚃",U:"𝚄",V:"𝚅",W:"𝚆",X:"𝚇",Y:"𝚈",Z:"𝚉",a:"𝚊",b:"𝚋",c:"𝚌",d:"𝚍",e:"𝚎",f:"𝚏",g:"𝚐",h:"𝚑",i:"𝚒",j:"𝚓",k:"𝚔",l:"𝚕",m:"𝚖",n:"𝚗",o:"𝚘",p:"𝚙",q:"𝚚",r:"𝚛",s:"𝚜",t:"𝚝",u:"𝚞",v:"𝚟",w:"𝚠",x:"𝚡",y:"𝚢",z:"𝚣",0:"𝟶",1:"𝟷",2:"𝟸",3:"𝟹",4:"𝟺",5:"𝟻",6:"𝟼",7:"𝟽",8:"𝟾",9:"𝟿"}},g={underline:"̲",strikethrough:"̶"},y={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"A","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","Ÿ":"Y","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"a","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y"};function b(e){return y[e]||e}function x(e){return function(t){if(!t||"string"!=typeof t)return t;try{let n="";for(let i=0;i<t.length;i++){const o=t[i];let r=e[o];if(!r){const t=b(o);r=e[t]}n+=r||o}return n}catch(n){return t}}}function w(e,t=null){return function(n){if(!n||"string"!=typeof n)return n;try{let i="";const o=t?x(t)(n):n;for(let t=0;t<o.length;t++){const n=o[t];i+=n,""===n.trim()||n.match(/\s/)||(i+=e)}return i}catch(i){return n}}}function E(){const e={};return Object.entries(p).forEach(([t,n])=>{const i=function(e){const t={};return Object.entries(e).forEach(([e,n])=>{t[n]=e}),t}(n);Object.assign(e,i)}),e}const S={toBold:x(p.bold),toItalic:x(p.italic),toUnderline:function(e){if(!e||"string"!=typeof e)return e;try{let t="";for(let n=0;n<e.length;n++){const i=e[n];let o=p.monospace[i];if(!o){const e=b(i);o=p.monospace[e]}t+=o?o+g.underline:" "===i?i:i+g.underline}return t}catch(t){return e}},toStrikethrough:w(g.strikethrough),reverseMap:E(),combiningChars:Object.values(g)},v=S.toBold,F=S.toItalic,T=S.toUnderline,k=S.toStrikethrough;function I(e){if(!e||"string"!=typeof e)return e;try{let t="";const n=S.reverseMap,i=S.combiningChars;for(const o of e){if(i.includes(o))continue;t+=n[o]||o}return t}catch(t){return e}}function C(e){if(!e||"string"!=typeof e)return[];const t=[];try{const n=S.combiningChars,i={bold:/[\u{1D400}-\u{1D419}\u{1D41A}-\u{1D433}\u{1D7CE}-\u{1D7D7}]/u,italic:/[\u{1D608}-\u{1D621}\u{1D622}-\u{1D63B}]/u,monospace:/[\u{1D670}-\u{1D689}\u{1D68A}-\u{1D6A3}\u{1D7F6}-\u{1D7FF}]/u};return i.bold.test(e)&&t.push("bold"),i.italic.test(e)&&t.push("italic"),e.includes(n[0])&&t.push("underline"),e.includes(n[1])&&t.push("strikethrough"),i.monospace.test(e)&&!t.includes("underline")&&t.push("underline"),t}catch(n){return[]}}function D(e,t){const n={bold:v,italic:F,underline:T,strikethrough:k};return n[t]?n[t](e):e}const L=new class{constructor(){this.supportedFormats=e.formats.supported,this.formatFunctions=this.initializeFormatFunctions()}initializeFormatFunctions(){return{bold:v,italic:F,underline:T,strikethrough:k,normal:I}}async formatText(e,t,n=[]){return u.safeExecute(async()=>{this.validateFormatRequest(e,t);const i=function(e,t,n){if(!e||"string"!=typeof e)return e;if(!n||"string"!=typeof n)return e;t=t||[];try{return t.includes(n)?I(e):t.length>0?D(I(e),n):D(e,n)}catch(i){return e}}(e,n,t);return this.validateFormattedText(i,e,t),i},i,{formatType:t,textLength:e?.length})}detectFormats(e){return u.safeExecute(()=>e&&"string"==typeof e?C(e):[],i,{textLength:e?.length})||[]}validateFormatRequest(t,n){if(!t||"string"!=typeof t)throw new h("Invalid text provided for formatting",i,l,{textType:typeof t,formatType:n});if(!n||!this.supportedFormats.includes(n))throw new h("Unsupported format type",i,l,{formatType:n,supportedFormats:this.supportedFormats});if(t.length>e.security.maxInputLength)throw new h("Text too long for formatting",i,l,{textLength:t.length,maxLength:e.security.maxInputLength})}validateFormattedText(e,t,n){if(!e||"string"!=typeof e)throw new h("Formatting failed to produce valid text",i,c,{formatType:n,originalLength:t.length});if(t.trim()&&!e.trim())throw new h("Formatting resulted in empty text",i,c,{formatType:n,originalText:t.substring(0,50)})}async applySimpleFormat(e,t){return u.safeExecute(async()=>{this.validateFormatRequest(e,t);const n=this.formatFunctions[t];if(!n)throw new h("Format function not found",i,l,{formatType:t,availableFunctions:Object.keys(this.formatFunctions)});const o=n(e);return this.validateFormattedText(o,e,t),o},i,{formatType:t,textLength:e?.length})}async removeAllFormats(e){return u.safeExecute(async()=>e&&"string"==typeof e?I(e):e,i,{operation:"removeAllFormats",textLength:e?.length})}hasFormats(e){return u.safeExecute(()=>{if(!e||"string"!=typeof e)return!1;return this.detectFormats(e).length>0},i,{operation:"hasFormats",textLength:e?.length})||!1}getSupportedFormats(){return[...this.supportedFormats]}getFormatInfo(t){return e.formats.definitions[t]||null}async previewFormat(e,t){return u.safeExecute(async()=>{this.validateFormatRequest(e,t);const n=this.detectFormats(e),i=await this.formatText(e,t,n);return{original:e,formatted:i,formatType:t,existingFormats:n,hasChanges:e!==i}},i,{operation:"preview",formatType:t,textLength:e?.length})}};const A=new class{constructor(){this.activeOperations=new Map,this.operationCounter=0,this.statistics={totalOperations:0,successfulOperations:0,failedOperations:0,averageProcessingTime:0}}async orchestrateFormatting(e){const t=this.generateOperationId(),n=Date.now();return u.safeExecute(async()=>{this.validateFormatRequest(e),this.registerOperation(t,e),e.formatType,e.selectionData.text.length;const i=await this.analyzeSelection(e.selectionData),o=await this.prepareFormatting(e.selectionData,e.formatType,i),r=await this.applyFormatting(o,e.formatType),s=await this.applyUIChanges(e.selectionData,r),a=await this.finalizeOperation(t,s,n);return this.updateStatistics(!0,Date.now()-n),a},i,{operationId:t,formatType:e.formatType})}validateFormatRequest(e){if(!e)throw new h("Format request is required",i,c,{request:e});if(!e.selectionData)throw new h("Selection data is required",i,c,{request:Object.keys(e)});if(!e.formatType)throw new h("Format type is required",i,c,{request:Object.keys(e)});if(!e.selectionData.text)throw new h("No text selected for formatting",i,l,{formatType:e.formatType})}generateOperationId(){return`format_${++this.operationCounter}_${Date.now()}`}registerOperation(e,t){this.activeOperations.set(e,{id:e,startTime:Date.now(),formatType:t.formatType,textLength:t.selectionData.text.length,status:"started"})}async analyzeSelection(e){return u.safeExecute(async()=>{const t=e.text,n=e.existingFormats||L.detectFormats(t),i={text:t,length:t.length,existingFormats:n,hasFormats:n.length>0,field:e.field,fieldType:e.fieldInfo?.tagName,isContentEditable:"true"===e.field?.contentEditable};return i},i,{operation:"analyze"})}async prepareFormatting(e,t,n){return u.safeExecute(async()=>{const i=this.checkFormatConflicts(n.existingFormats,t),o=this.determineFormatStrategy(t,n.existingFormats,i),r={text:n.text,formatType:t,existingFormats:n.existingFormats,strategy:o,conflicts:i,field:e.field,range:e.range};return i.length,r},i,{operation:"prepare",formatType:t})}checkFormatConflicts(e,t){const n=[];return e.forEach(e=>{e===t&&n.push({type:"duplicate",format:e,message:`Format ${e} already applied`})}),n}determineFormatStrategy(e,t,n){if(n.length>0){if(n.some(e=>"duplicate"===e.type))return"toggle"}return 0===t.length?"apply":"incremental"}async applyFormatting(e,t){return u.safeExecute(async()=>{let n;switch(e.strategy){case"toggle":n=await L.removeAllFormats(e.text);break;case"apply":n=await L.applySimpleFormat(e.text,t);break;default:n=await L.formatText(e.text,t,e.existingFormats)}const i={originalText:e.text,formattedText:n,formatType:t,strategy:e.strategy,hasChanges:e.text!==n};return e.strategy,i},i,{operation:"apply",formatType:t})}async applyUIChanges(e,t){return u.safeExecute(async()=>t.hasChanges?("true"===e.field.contentEditable?await this.applyContentEditableChange(e.field,e.range,t.formattedText):await this.applyInputFieldChange(e.field,t.formattedText),await this.triggerLinkedInEvents(e.field),{success:!0,message:"Changes applied successfully",formatResult:t}):{success:!0,message:"No changes to apply",formatResult:t},r,{fieldType:e.fieldInfo?.tagName})}async applyContentEditableChange(e,t,n){return u.safeExecute(async()=>{t.deleteContents();const e=document.createTextNode(n);t.insertNode(e),t.setStartAfter(e),t.setEndAfter(e);const i=window.getSelection();i.removeAllRanges(),i.addRange(t),i.collapseToEnd()},r,{operation:"contenteditable"})}async applyInputFieldChange(e,t){return u.safeExecute(async()=>{const n=e.selectionStart,i=e.selectionEnd,o=e.value;e.value=o.substring(0,n)+t+o.substring(i);const r=n+t.length;e.setSelectionRange(r,r)},r,{operation:"input"})}async triggerLinkedInEvents(t){return u.safeExecute(async()=>{e.events.linkedinNotification.forEach(e=>{const n=new Event(e,{bubbles:!0,cancelable:!0});t.dispatchEvent(n)}),t.focus()},r,{operation:"events"})}async finalizeOperation(e,t,n){return u.safeExecute(async()=>{const i=this.activeOperations.get(e);return i&&(i.status="completed",i.endTime=Date.now(),i.duration=i.endTime-n),setTimeout(()=>{this.activeOperations.delete(e)},5e3),t.success,{operationId:e,success:t.success,message:t.message,duration:i?.duration,formatResult:t.formatResult}},i,{operationId:e})}updateStatistics(e,t){this.statistics.totalOperations++,e?this.statistics.successfulOperations++:this.statistics.failedOperations++;const n=(this.statistics.averageProcessingTime+t)/2;this.statistics.averageProcessingTime=Math.round(n)}getStatistics(){return{...this.statistics,activeOperations:this.activeOperations.size,successRate:this.statistics.totalOperations>0?(this.statistics.successfulOperations/this.statistics.totalOperations*100).toFixed(2):0}}getActiveOperations(){return Array.from(this.activeOperations.values())}cleanup(){this.activeOperations.clear(),this.statistics={totalOperations:0,successfulOperations:0,failedOperations:0,averageProcessingTime:0}}};const O=new class{constructor(){this.activeFormats=new Map}async applyFormatting(e,t){return u.safeExecute(async()=>{if(!e||!t)throw new h("Invalid parameters for formatting",i,l,{selectionData:!!e,formatType:t});if(!e.text||0===e.text.length)throw new h("No text selected for formatting",i,a,{formatType:t});e.text.length;return(await A.orchestrateFormatting({selectionData:e,formatType:t})).success},i,{formatType:t,textLength:e?.text?.length})}async replaceSelectedText(e,t){return u.safeExecute(async()=>{const n=e.field,i=e.range;if(!n)throw new h("No field found for text replacement",o,c,{newText:t.substring(0,50)});if("true"===n.contentEditable)await this.handleContentEditableField(n,i,t);else{if("TEXTAREA"!==n.tagName&&"INPUT"!==n.tagName)throw new h("Unsupported field type for text replacement",o,l,{fieldType:n.tagName,fieldId:n.id});await this.handleInputField(n,t)}},o,{fieldType:e.field?.tagName})}async handleContentEditableField(e,t,n){return u.safeExecute(async()=>{if(!t)throw new h("No range provided for contenteditable field",o,c,{fieldId:e.id});t.deleteContents();const i=document.createTextNode(n);t.insertNode(i),t.setStartAfter(i),t.setEndAfter(i),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),window.getSelection().collapseToEnd(),await this.triggerLinkedInEvents(e)},o,{fieldType:"contenteditable",fieldId:e.id})}async handleInputField(e,t){return u.safeExecute(async()=>{const n=e.selectionStart,i=e.selectionEnd,r=e.value;if(null===n||null===i)throw new h("No selection found in input field",o,l,{fieldId:e.id,fieldType:e.tagName});e.value=r.substring(0,n)+t+r.substring(i);const s=n+t.length;e.setSelectionRange(s,s),await this.triggerLinkedInEvents(e)},o,{fieldType:e.tagName,fieldId:e.id})}async triggerLinkedInEvents(t){return u.safeExecute(async()=>{e.events.linkedinNotification.forEach(e=>{try{const n=new Event(e,{bubbles:!0,cancelable:!0});t.dispatchEvent(n)}catch(n){throw new h(`Failed to dispatch event: ${e}`,r,a,{eventType:e,fieldId:t.id,error:n.message})}});try{t.focus()}catch(n){throw new h("Failed to focus field after text replacement",r,a,{fieldId:t.id,error:n.message})}},r,{fieldId:t.id})}detectExistingFormats(e){return C(e)}};const N=new class{constructor(){this.isInitialized=!1,this.currentSelection=null,this.handleSelectionEvent=this.handleSelectionEvent.bind(this)}async init(){if(!this.isInitialized)return u.safeExecute(async()=>{if(!this.isLinkedInPage())throw new h("Not on LinkedIn page, skipping initialization",n,a,{hostname:window.location.hostname});m.init(),m.addSelectionHandler(this.handleSelectionEvent),this.registerFormatHandlers(),this.isInitialized=!0},n,{hostname:window.location.hostname})}isLinkedInPage(){const t=window.location.hostname,n=(i=t,e.security.allowedDomains.some(e=>e.startsWith("*.")?i.endsWith(e.slice(2)):i===e));var i;return n}handleSelectionEvent(e,t){"selection"===e?this.onTextSelected(t):"deselection"===e&&this.onTextDeselected(t)}onTextSelected(e){this.currentSelection=e,e.text.length,e.fieldInfo.tagName;const t=C(e.text);e.existingFormats=t,this.showToolbox(e)}onTextDeselected(e){this.currentSelection=null,this.hideToolbox()}showToolbox(e){f.show(e)}hideToolbox(){f.hide()}registerFormatHandlers(){const t=e.formats.supported;t.forEach(e=>{f.addFormatHandler(e,(e,t)=>{this.applyFormatting(e,t)})})}async applyFormatting(e,t){return u.safeExecute(async()=>{if(!e||!t)throw new h("Invalid parameters for applyFormatting",i,l,{hasSelectionData:!!e,formatType:t});return await O.applyFormatting(e,t)},i,{formatType:t})}getCurrentSelection(){return this.currentSelection}destroy(){this.isInitialized&&(m.removeSelectionHandler(this.handleSelectionEvent),m.destroy(),f.destroy(),this.currentSelection=null,this.isInitialized=!1)}};window.linkedInFormatterToolbox=N,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>N.init()):N.init();let H=window.location.href;new MutationObserver(()=>{window.location.href!==H&&(H=window.location.href,setTimeout(()=>{N.destroy(),N.init()},e.performance.cleanupInterval/30))}).observe(document.body,{childList:!0,subtree:!0});
